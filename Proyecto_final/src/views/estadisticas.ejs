<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estadísticas de Lectura</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="container mt-4">
    <h1 class="text-center mb-4"><i class="fas fa-chart-pie me-2"></i>ESTADÍSTICAS DE LECTURA</h1>
    
    <div class="text-center mb-4">
        <a href="/" class="btn btn-secondary"><i class="fas fa-arrow-left me-1"></i>Volver a la Biblioteca</a>
    </div>

    <!-- Filtros -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <form action="/estadisticas" method="GET" class="row g-3 align-items-end justify-content-center">
                <div class="col-md-3">
                    <label for="genero" class="form-label">Género</label>
                    <input type="text" class="form-control" id="genero" name="genero" placeholder="Ej: Ciencia Ficción" value="<%= filtroAplicado.genero || '' %>">
                </div>
                <div class="col-md-3">
                    <label for="autor" class="form-label">Autor</label>
                    <input type="text" class="form-control" id="autor" name="autor" placeholder="Ej: George Orwell" value="<%= filtroAplicado.autor || '' %>">
                </div>
                <div class="col-md-3">
                    <button type="submit" class="btn btn-primary w-100"><i class="fas fa-filter me-1"></i>Filtrar</button>
                </div>
                <% if (filtroAplicado.genero || filtroAplicado.autor) { %>
                <div class="col-md-1">
                    <a href="/estadisticas" class="btn btn-outline-secondary w-100" title="Limpiar filtros"><i class="fas fa-undo"></i></a>
                </div>
                <% } %>
            </form>
        </div>
    </div>

    <div class="mb-4 text-center">
        <h3 class="text-primary">Total de Libros: <%= totalLibros %></h3>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <% estadisticas.forEach(function(stat){ %>
                <div class="card p-3 mb-3 shadow-sm">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0">
                            <% if(stat.estado === 'Leído') { %>
                                <i class="fas fa-check-circle text-success me-2"></i>
                            <% } else if(stat.estado === 'Leyendo') { %>
                                <i class="fas fa-book-reader text-warning me-2"></i>
                            <% } else { %>
                                <i class="fas fa-hourglass-half text-info me-2"></i>
                            <% } %>
                            <%= stat.estado %>
                        </h5>
                        <span class="badge bg-light text-dark border">
                            <strong><%= stat.conteo %></strong> libros (<%= stat.porcentaje %>%)
                        </span>
                    </div>
                    <div class="progress" style="height: 25px;">
                        <div class="progress-bar 
                            <% if(stat.estado === 'Leído') { %> bg-success 
                            <% } else if(stat.estado === 'Leyendo') { %> bg-warning text-dark
                            <% } else { %> bg-info text-dark <% } %>" 
                            role="progressbar" 
                            style="width: <%= stat.porcentaje %>%" 
                            aria-valuenow="<%= stat.porcentaje %>" 
                            aria-valuemin="0" 
                            aria-valuemax="100">
                            <%= stat.porcentaje %>%
                        </div>
                    </div>
                </div>
            <% }) %>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>