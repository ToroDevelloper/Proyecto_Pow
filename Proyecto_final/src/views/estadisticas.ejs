<%- include('partials/encabezado') %>

<!-- Encabezado principal elegante -->
<div class="header-section mb-5">
    <div class="row align-items-center">
        <div class="col">
            <h1 class="header-title"><i class="fas fa-chart-bar me-3"></i>Estadísticas de Lectura</h1>
            <p class="header-subtitle">Visualiza tu progreso y avance en la lectura</p>
        </div>
    </div>
</div>

<!-- Filtros elegantes -->
<div class="card card-featured mb-5 shadow">
    <div class="card-header card-header-featured">
        <div class="d-flex align-items-center">
            <div class="featured-icon me-3">
                <i class="fas fa-filter"></i>
            </div>
            <div>
                <h5 class="mb-0">Filtrar Estadísticas</h5>
                <small class="text-light-secondary">Busca por género o autor</small>
            </div>
        </div>
    </div>
    <div class="card-body">
        <form action="/estadisticas" method="GET" class="row g-3 align-items-end justify-content-center">
            <div class="col-md-3">
                <label for="genero" class="form-label">Género</label>
                <input type="text" class="form-control" id="genero" name="genero" placeholder="Ej: Ciencia Ficción" value="<%= filtroAplicado.genero || '' %>">
            </div>
            <div class="col-md-3">
                <label for="autor" class="form-label">Autor</label>
                <input type="text" class="form-control" id="autor" name="autor" placeholder="Ej: George Orwell" value="<%= filtroAplicado.autor || '' %>">
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-elegant w-100"><i class="fas fa-search me-1"></i>Filtrar</button>
            </div>
            <% if (filtroAplicado.genero || filtroAplicado.autor) { %>
            <div class="col-md-1">
                <a href="/estadisticas" class="btn btn-outline-secondary w-100" title="Limpiar filtros"><i class="fas fa-undo"></i></a>
            </div>
            <% } %>
        </form>
    </div>
</div>

<!-- Resumen total -->
<div class="row mb-5">
    <div class="col-md-12">
        <div class="card stats-summary shadow">
            <div class="card-body">
                <div class="text-center">
                    <h3 class="stats-title">Total de Libros en tu Biblioteca</h3>
                    <div class="stats-number"><%= totalLibros %></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Estadísticas por estado -->
<div class="row">
    <div class="col-md-12">
        <div class="library-header mb-4">
            <h6 class="library-title">
                <i class="fas fa-chart-pie me-2"></i>Progreso de Lectura
            </h6>
        </div>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-lg-10">
        <% estadisticas.forEach(function(stat){ %>
            <div class="card stats-card shadow-sm mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="stats-label">
                            <% if(stat.estado === 'Leído') { %>
                                <i class="fas fa-check-circle stats-icon stats-icon-leido me-2"></i>
                                <strong>Libros Leídos</strong>
                            <% } else if(stat.estado === 'Leyendo') { %>
                                <i class="fas fa-book-open stats-icon stats-icon-leyendo me-2"></i>
                                <strong>Libros Leyendo</strong>
                            <% } else { %>
                                <i class="fas fa-hourglass-half stats-icon stats-icon-pendiente me-2"></i>
                                <strong>Libros Pendientes</strong>
                            <% } %>
                        </div>
                        <div class="stats-badge">
                            <span class="badge badge-count"><%= stat.conteo %></span>
                            <span class="stats-percentage"><%= stat.porcentaje %>%</span>
                        </div>
                    </div>
                    <div class="progress stats-progress">
                        <div class="progress-bar 
                            <% if(stat.estado === 'Leído') { %> progress-leido
                            <% } else if(stat.estado === 'Leyendo') { %> progress-leyendo
                            <% } else { %> progress-pendiente <% } %>" 
                            role="progressbar" 
                            data-width="<%= stat.porcentaje %>"
                            aria-valuenow="<%= stat.porcentaje %>" 
                            aria-valuemin="0" 
                            aria-valuemax="100">
                        </div>
                    </div>
                </div>
            </div>
        <% }) %>
    </div>
</div>

<script>
    // Aplicar ancho a las barras de progreso
    document.addEventListener('DOMContentLoaded', function() {
        const progressBars = document.querySelectorAll('.progress-bar[data-width]');
        progressBars.forEach(bar => {
            const width = bar.getAttribute('data-width');
            bar.style.width = width + '%';
        });
    });
</script>

<%- include('partials/pie') %>